(()=>{"use strict";var e=document.querySelector(".places__list"),t=document.querySelectorAll(".popup__close"),n=document.querySelectorAll(".popup"),r=document.querySelector(".profile__edit-button"),o=document.querySelector(".popup_type_edit"),c=document.querySelector(".profile__title"),i=document.querySelector(".profile__description"),a=o.querySelector(".popup__form"),u=a.querySelector(".popup__input_type_name"),l=a.querySelector(".popup__input_type_description"),s=document.querySelector(".profile__add-button"),d=document.querySelector(".popup_type_new-card"),p=d.querySelector(".popup__form"),f=p.querySelector(".popup__input_type_card-name"),_=p.querySelector(".popup__input_type_url"),v=document.querySelector(".popup_type_image"),m=v.querySelector(".popup__image"),y=v.querySelector(".popup__caption"),h=document.querySelector(".popup_type_avatar"),S=document.querySelector(".profile__image"),b=h.querySelector(".popup__form"),g=b.querySelector(".popup__input_type_avatar"),q={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},E={baseUrl:"https://nomoreparties.co/v1/wff-cohort-9/",headers:{authorization:"406720eb-77f9-418f-ad2a-325463878595","Content-Type":"application/json"}},L=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},C=function(e,t){return fetch(E.baseUrl+e,t).then(L)},k=document.getElementById("card-template");function A(e,t,n){var r=k.content.querySelector(".places__item").cloneNode(!0),o=r.querySelector(".card__title"),c=r.querySelector(".card__image"),i=r.querySelector(".card__delete-button"),a=r.querySelector(".card__like-button"),u=r.querySelector(".card__like-counter"),l=e._id,s=e.likes.some((function(e){return e._id===n}));return o.textContent=e.name,c.src=e.link,c.alt=e.name,c.addEventListener("click",t),u.textContent=e.likes.length,n===e.owner._id&&(i.classList.add("card__delete-button_is-active"),i.addEventListener("click",(function(){x(r,l)}))),a.addEventListener("click",(function(){w(u,a,l)})),s&&a.classList.add("card__like-button_is-active"),r}var x=function(e,t){var n;(n=t,C("/cards/".concat(n),{method:"DELETE",headers:E.headers})).then((function(){e.remove()})).catch((function(e){console.log(e)}))},w=function(e,t,n){var r;t.classList.contains("card__like-button_is-active")?(r=n,C("/cards/likes/".concat(r),{method:"DELETE",headers:E.headers})).then((function(n){t.classList.toggle("card__like-button_is-active"),e.textContent=n.likes.length})).catch((function(e){console.log(e)})):function(e){return C("/cards/likes/".concat(e),{method:"PUT",headers:E.headers})}(n).then((function(n){t.classList.toggle("card__like-button_is-active"),e.textContent=n.likes.length})).catch((function(e){console.log(e)}))},T=function(e){e.classList.add("popup_is-animated"),setTimeout((function(){e.classList.add("popup_is-opened")}),1),document.addEventListener("keydown",B)},j=function(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",B)},B=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");j(t)}},O=function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""},P=function(e,t){e.disabled=!1,e.classList.remove(t.inactiveButtonClass)},D=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?P(t,n):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))},I=function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(n){O(e,n,t)})),D(n,r,t)},N=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранение...";t.textContent=e?r:n},U=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранение...";t.preventDefault();var r=t.submitter,o=r.textContent;N(!0,r,o,n),e().then((function(){t.target.reset()})).catch((function(e){console.error("Ошибка: ".concat(e))})).finally((function(){N(!1,r,o,n)}))};function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var M="",H=function(e){var t=e.target;m.src=t.src,m.alt=t.alt,y.textContent=t.alt,T(v)};r.addEventListener("click",(function(){T(o),V(),I(a,q)})),S.addEventListener("click",(function(){T(h),I(b,q)})),s.addEventListener("click",(function(){T(d),I(p,q)})),t.forEach((function(e){e.addEventListener("click",(function(e){var t=e.target.closest(".popup_is-opened");j(t)}))})),n.forEach((function(e){e.addEventListener("click",(function(t){!t.target.closest(".popup__content")&&e.classList.contains("popup_is-opened")&&j(e)}))}));var V=function(){u.value=c.textContent,l.value=i.textContent};b.addEventListener("submit",(function(e){U((function(){return(e=g.value,C("/users/me/avatar",{method:"PATCH",headers:E.headers,body:JSON.stringify({avatar:"".concat(e)})})).then((function(){S.setAttribute("style","background-image: url('".concat(g.value,"');")),j(h)}));var e}),e)})),a.addEventListener("submit",(function(e){U((function(){return(e=u.value,t=l.value,C("/users/me",{method:"PATCH",headers:E.headers,body:JSON.stringify({name:"".concat(e),about:"".concat(t)})})).then((function(e){c.textContent=e.name,i.textContent=e.about,j(o)}));var e,t}),e)})),p.addEventListener("submit",(function(t){var n={name:f.value,link:_.value};U((function(){return(t=n.name,r=n.link,C("/cards",{method:"POST",headers:E.headers,body:JSON.stringify({name:"".concat(t),link:"".concat(r)})})).then((function(t){var n,r;n=A(t,H,M),r=e.firstChild,e.insertBefore(n,r),j(d)}));var t,r}),t,"Создание...")})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);D(n,r,t),e.addEventListener("reset",(function(){P(r,t)})),n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.error):t.setCustomValidity(""),t.validity.valid?O(e,t,n):function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),r.textContent=t.validationMessage,r.classList.add(n.errorClass)}(e,t,n)}(e,o,t),D(n,r,t)}))}))}(t,e)}))}(q),Promise.all([C("/cards",{headers:E.headers}),C("/users/me",{headers:E.headers})]).then((function(t){var n,r,o,a=(o=2,function(e){if(Array.isArray(e))return e}(r=t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c,i,a=[],u=!0,l=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=c.call(n)).done)&&(a.push(r.value),a.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw o}}return a}}(r,o)||function(e,t){if(e){if("string"==typeof e)return J(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?J(e,t):void 0}}(r,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=a[0],l=a[1];n=l,c.textContent=n.name,i.textContent=n.about,M=n._id,function(e){S.setAttribute("style","background-image: url('".concat(e.avatar,"');"))}(l),u.forEach((function(t){!function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"prepend",r=A(t,H,M);e[n](r)}(t,"append")}))})).catch((function(e){console.log(e)}))})();